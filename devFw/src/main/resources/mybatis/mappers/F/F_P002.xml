<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="F.P002">
	<resultMap id="F_P002Result01" type="F_P002VO">
		<result property="sell_number" column="sell_number" />
		<result property="pro_number" column="pro_number" />
		<result property="pro_name" column="pro_name" />
		<result property="sell_price" column="sell_price" />
		<result property="sell_score" column="sell_score" />
		<result property="sell_contents" column="sell_contents" />
		<result property="sell_total" column="sell_total" />
		<result property="sell_date" column="sell_date" />
		<result property="sell_title" column="sell_title" />
		<result property="sell_thumbnail" column="sell_thumbnail" />
		<result property="sell_quantity" column="sell_quantity" />
		<result property="mem_ID" column="mem_ID" />
		<result property="option_yn" column="option_yn" />
		<result property="bigCtgrCode" column="bigc" />
		<result property="smallCtgrCode" column="pro_division" />
		<result property="bigCtgrName" column="bign" />
		<result property="smallCtgrName" column="common_name" />	
	</resultMap>
	
	<resultMap id="F_P002Result02" type="F_P002VO">
		<result property="sell_number" column="sell_number" />
		<result property="option_size" column="option_size" />
		<result property="option_color" column="option_color" />
		<result property="option_quantity" column="option_quantity" />
	</resultMap>
	
	<select id="searchItem" resultMap="F_P002Result01" parameterType="java.util.Map"> 
      <![CDATA[
         select sell_number, ps.pro_number, pro_name, sell_price, sell_score, sell_contents, sell_contents, sell_total
         , sell_date, sell_title, sell_thumbnail, sell_quantity, ps.mem_ID, option_yn, pro_division, common_name, substr(common_code,0,4) bigc
         ,(select common_name from commonlist where common_code = substr(pro_division,0,4)) bign
         
         from productsell ps, product p ,commonlist cl
         where ps.pro_number = p.pro_number
		 and p.pro_division = cl.common_code
         and sell_number = ${p_id}
      ]]>
      <!-- 
		<where>
			ps.pro_number = p.pro_number
			and p.pro_division = cl.common_code
			<if test=" p_id != ''  and  p_id != null">
				and sell_number = ${p_id}
			</if>
		</where>
		 -->
	</select>
	
	<select id="searchOption" resultMap="F_P002Result02" parameterType="java.util.Map"> 
      <![CDATA[
         select sell_number, option_size, option_color, option_quantity

         from selloption
         where sell_number = ${p_id}
         order by to_number(option_size) 
      ]]>

	</select>
 
	<insert id="addBasket" parameterType="java.util.Map">
		<![CDATA[
			insert into basket2 (mem_id, sell_number, ba_size, ba_color, ba_quantity)
			values('${p_id}','${sell_number}','${size}','${color}', '${quantity}')
		]]>
	</insert>
 


	<select id="mainList" resultType="project.F.P002.vo.F_P002VO" parameterType="project.main.paging.MainPagingVO">
	<!-- 각각의 상품을 등록일 순으로 조회 -->
	  <![CDATA[
	  	select sell_number, sell_title, sell_price, sell_thumbnail
		from (
	        select sell_number, sell_title, sell_price, sell_thumbnail,
	        row_number() over (order by sell_number desc) as rNum
	        from productsell
	        ) mb
       where rNum between #{rowStart} and #{rowEnd}
	  ]]>
	</select>
	
	<select id="countList" resultType="Integer">
	<!-- 조회한 상품의 갯수를 뿌려줌 -->
		<![CDATA[
			select count(sell_number) as totalCount
			from productsell
			where sell_number > 0
		]]>
	</select>
	
	<!-- 검색어 자동완성 -->
	<select id="searchKeyword"  resultType="String" parameterType="String">
	  <![CDATA[
	    select pro_name
	    from product
	    where pro_name like '%' || #{keyword} || '%'
		order by pro_name
	  ]]>
	</select>
	
	<!-- 상품 검색 결과 -->
	<select id="searchWord" resultType="project.F.P002.vo.F_P002VO" parameterType="project.search.paging.SearchPagingVO">
	    select sell_number, sell_thumbnail, sell_title, sell_price, sell_date, mem_ID
	    from (
	    		select sell_number, sell_thumbnail, sell_title, sell_price, sell_date, mem_id,
	    		row_number() over (order by sell_number desc) as rNum
	    		from productsell
	    		where sell_title like '%' || #{searchWord} || '%'
	    		) mb
	    where rNum between #{rowStart} and #{rowEnd}
	</select>
	
	<sql id="search">
		<if test="searchType == null">
			where sell_title like '%' || #{searchWord} || '%'
		</if>
	</sql>
	
	<select id="countSearch" resultType="int">
			select count(sell_number)
			from productsell
					<include refid="search"></include>
		<![CDATA[
			and sell_number > 0
		]]>
	</select>
</mapper>