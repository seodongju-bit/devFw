<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
   <mapper namespace="mapper.active">
	<resultMap id="couResult" type="activeVO">
		<result property="co_number" column="co_number" />
        <result property="co_name" column="co_name" />
        <result property="co_enddate" column="co_enddate" />
        <result property="co_stdate" column="co_stdate" />
        <result property="co_percent" column="co_percent" />
        <result property="mem_id" column="mem_id" />
	</resultMap> 
	
	<resultMap id="pointResult" type="activeVO">
		<result property="mem_no" column="mem_no" />
        <result property="point_number" column="point_number" />
        <result property="point_date" column="point_date" />
        <result property="point_usedate" column="point_usedate" />
        <result property="point_usemoney" column="point_usemoney" />
        <result property="order_number" column="order_number" />
        <result property="point_content" column="point_content" />
        <result property="mem_id" column="mem_id" />
	</resultMap> 
	
	<resultMap id="orderListResult" type="java.util.Map">
		<result property="mem_id" column="mem_id" />
	</resultMap> 
	
	<select id="selectAllCouponList" resultMap="couResult">
      <![CDATA[
         select 
         mc.co_number, 
         c.co_name, 
         to_char(c.co_enddate,'YYYY-MM-DD') co_enddate, 
         to_char(c.co_stdate,'YYYY-MM-DD') co_stdate,
         c.co_percent
		 from coupon c, mycoupon mc
		 where c.co_number = mc.co_number
		 and mem_id = #{p_id}	
      ]]>
	</select>
	  
	<select id="selectAllPointlist" resultMap="pointResult" parameterType="java.util.Map">
      <![CDATA[
         SELECT * 
         FROM pointuse
         WHERE mem_id=#{mem_id}
         
       ]]>
          
        <choose>
        	<when test="start != '' and end !='' and date != ''"> 
        		AND ${date} between to_date('${start}', 'YYYY-MM-DD') 
       			AND  to_date('${end}', 'YYYY-MM-DD')+0.9999
    		</when>
		</choose>
	</select>
	  

	<select id="orderList" resultMap="orderListResult" parameterType="java.util.Map">
      <![CDATA[
         select (DENSE_RANK() OVER(order by order_date DESC, od.order_number DESC)) rownums, o.order_number,od.sell_number, order_date ,sell_price, sell_title, sell_thumbnail, od_state
         from orders o, orderdetail od, productsell ps
         where od.sell_number = ps.sell_number
         and o.order_number = od.order_number
         and o.mem_id = #{mem_id}
      ]]>
	</select>
	
	<select id="orderList2" resultMap="orderListResult" parameterType="java.util.Map">
      <![CDATA[
         select (DENSE_RANK() OVER(order by order_date DESC, od.order_number DESC)) rownums, o.order_number,od.sell_number, order_date ,sell_price, sell_title, sell_thumbnail, od_state
         from orders o, orderdetail od, productsell ps
         where od.sell_number = ps.sell_number
         and o.order_number = od.order_number
         and o.mem_id = #{mem_id}
      ]]>
	</select>
	
	<select id="orderList3" resultMap="orderListResult" parameterType="java.util.Map">
      <![CDATA[
         select p.sell_thumbnail, p.sell_title, b.sell_number
         from basket2 b, productsell p
         where b.sell_number = p.sell_number
         and b.mem_id =  #{mem_id}
         and rownum <3
      ]]>
	</select>
	
	<select id="quList" resultMap="orderListResult" parameterType="java.util.Map">
      <![CDATA[
         select MEM_ID, QU_CONTENTS, QU_NUMBER, QU_ANSWER,  to_char(qu_date, 'YYYY-MM-DD') QU_DATE
         from QUESTIONS
         where mem_id = #{mem_id}
      ]]>
	</select>
 	
	<insert id="takecoupon"  parameterType="makecouponVO">
  <![CDATA[
    	 INSERT INTO mycoupon (co_number, mem_id) 
      VALUES (#{co_number}, #{mem_id})            
   ]]>      
  </insert>
  
  
  <select id="givecoupon" resultMap="couResult">
      <![CDATA[
         select 
         co_number, 
         co_name, 
         to_char(co_enddate,'YYYY-MM-DD') co_enddate, 
         to_char(co_stdate,'YYYY-MM-DD') co_stdate,
         co_percent
		 from coupon 
		 order by co_stdate desc
      ]]>
	</select>
	
	<select id="countcoupon" parameterType="String" resultType="Integer">
	<![CDATA[
      SELECT COUNT(*) FROM mycoupon
      WHERE
          co_number = #{co_number} 
          and
          mem_id = #{mem_id}
           ]]> 
</select>

<select id="coulist" parameterType="String" resultType="Integer">
	<![CDATA[
      SELECT COUNT(*) FROM mycoupon
      WHERE
          mem_id = #{mem_id} 
           ]]> 
</select>

<select id="baslist" parameterType="String" resultType="Integer">
	<![CDATA[
      SELECT COUNT(*) FROM basket2
      WHERE
          mem_id = #{mem_id} 
           ]]> 
</select>

<select id="mempoint" parameterType="String" resultType="Integer">
	<![CDATA[
      select mem_point
         from members 
         where mem_id = #{mem_id}
           ]]> 
</select>

<select id="delcount" parameterType="String" resultType="Integer">
	<![CDATA[
     select count(od_state)
         from orders o, orderdetail od
         where o.order_number = od.order_number
         and mem_id = #{mem_id}
         and od.od_state = 'F_0003'
           ]]> 
</select>

	
	</mapper>